---
title: "Flight Data Tutorial"
output: html_document
---

## R Markdown

```{r}
library(dplyr)
library(ggplot2)
library(gdata)
library(lubridate)
```


```{r}

flight_data <- read.csv("2004.csv.bz2")
```

```{r}
flight_data_jan <- flight_data %>% 
  filter(Month == 1) 
  
```

```{r}
flight_data_test <- read.xls ("FlightDelays.xls", sheet = 1, header = TRUE)
```

```{r}


flight_data_test <- flight_data_test %>%
  mutate(is_delayed = if_else(ArrDelay > 0, 1, 0))
  
  
```




```{r}
g <- ggplot(flight_data_test, aes(Flight.Status, fill= Flight.Status)) +
  geom_bar() +
  xlab("Flight Status") +
  ylab("Number of Flights")

g
```


```{r}
summary(flight_data_test$Flight.Status)
```

```{r}
summary(flight_data_test$CARRIER)
```

```{r}
flight_data_test %>%
  group_by(CARRIER)%>%
  summarise( n = n()) %>%
  mutate(freq = round(n / sum(n), 2))
```



```{r}


day_of_week <- flight_data_test %>%
  group_by(DAY_WEEK, Flight.Status)%>%
  summarise( n = n()) %>%
  mutate(freq = n / sum(n))
  


```


```{r}
day_of_week$Flight.Status <- relevel(day_of_week$Flight.Status, 'ontime')
```


```{r}


# Stacked barplot with multiple groups
ggplot(data= day_of_week, aes(x=DAY_WEEK, y=freq, fill=Flight.Status)) +
  geom_bar(stat="identity")

```

```{r}
destination_airport <- flight_data_test %>%
  group_by(DEST, Flight.Status)%>%
  summarise( n = n()) %>%
  mutate(freq = n / sum(n))
```


```{r}

destination_airport$Flight.Status <- relevel(destination_airport$Flight.Status, 'ontime')

ggplot(data= destination_airport, aes(x=DEST, y=freq, fill=Flight.Status)) +
  geom_bar(stat="identity")
```


```{r}

origin_airport <- flight_data_test %>%
  group_by(ORIGIN, Flight.Status)%>%
  summarise( n = n()) %>%
  mutate(freq = n / sum(n))



origin_airport$Flight.Status <- relevel(origin_airport$Flight.Status, 'ontime')

ggplot(data= origin_airport
       
       , aes(x=ORIGIN, y=freq, fill=Flight.Status)) +
  geom_bar(stat="identity")
```

-----

#make dummy variables of categorical data

```{r}
flight_data_test$DAY_WEEK <- as.factor(flight_data_test$DAY_WEEK)
flights.dummy <- model.matrix(~CARRIER+DEST+ORIGIN+DAY_WEEK,data=flight_data_test)
flights.dummy <- flights.dummy[,-1]
```


#group by each hour

```{r}

flight_data_test$hour <- floor(flight_data_test$DEP_TIME/100)

flight_data_test$hour <- as.factor(flight_data_test$hour)


```


```{r}

flights.dummy1 <- model.matrix(~hour, data=flight_data_test)
flights.dummy1 <- flights.dummy1[,-1]

```

#Join it together


```{r}
flight_data_test_all <- as.data.frame(cbind(flights.dummy, flights.dummy1))


flight_data_test_all$Weather <- flight_data_test$Weather
flight_data_test_all$FlightStatus <- flight_data_test$Flight.Status

```

#Split test and train

```{r}



## 75% of the sample size
smp_size <- floor(0.6 * nrow(flight_data_test_all))

## set the seed to make your partition reproductible
set.seed(123)

train_ind <- sample(seq_len(nrow(flight_data_test_all)), size = smp_size)

train <-as.data.frame(flight_data_test_all[train_ind, ])
test <- as.data.frame(flight_data_test_all[-train_ind, ])


```

```{r}
glm(formula = FlightStatus ~ ., family = binomial, data = train)
```

